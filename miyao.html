<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outline密钥</title>
    <link rel="stylesheet" href="miyao.css"> <!-- 引入外部 CSS 文件 -->
</head>
<body>
    <div class="container">
        <h1>Outline密钥</h1>
        <div class="subscription-block">
            <p>订阅地址:</p>
            <pre id="subscription">https://raw.githubusercontent.com/vk55s/subscribe/refs/heads/main/chui</pre>
            <button id="copySubscription">复制订阅</button>
        </div>

        <hr>

        <div id="codeList">正在加载...</div>

        <div class="button-container">
            <button id="copyKey">复制密钥</button>
        </div>
    </div>
    <footer>&copy; 2024 - Outline 锤锤</footer>

    <script>
        // 订阅地址复制功能
        const subscriptionButton = document.getElementById('copySubscription');
        const subscriptionText = document.getElementById('subscription').textContent;

        subscriptionButton.addEventListener('click', () => {
            navigator.clipboard.writeText(subscriptionText).then(() => {
                subscriptionButton.textContent = '复制成功！';
                setTimeout(() => (subscriptionButton.textContent = '复制订阅'), 2000);
            });
        });

        // 加载密钥列表
        const codeList = document.getElementById('codeList');

        fetch('codes.txt')
            .then(response => {
                if (!response.ok) throw new Error('无法加载 codes.txt 文件');
                return response.text();
            })
            .then(data => {
                const lines = data.trim().split('\n');
                codeList.innerHTML = ''; // 清空加载提示

                lines.forEach(line => {
                    if (line.startsWith('ss://')) { // 仅处理 ss:// 开头的行
                        const [code, remark] = line.split('#'); // 提取代码和备注部分
                        const remarkText = remark ? decodeURIComponent(remark.trim()) : '无备注'; // 解码备注（包括表情）

                        const codeBlock = document.createElement('div');
                        codeBlock.classList.add('code-block');

                        const codeHeader = document.createElement('div');
                        codeHeader.classList.add('code-header');
                        codeHeader.textContent = `备注: ${remarkText}`;

                        const pre = document.createElement('pre');
                        pre.textContent = code;

                        const button = document.createElement('button');
                        button.textContent = '复制密钥';
                        button.addEventListener('click', () => {
                            navigator.clipboard.writeText(code).then(() => {
                                button.textContent = '复制成功！';
                                setTimeout(() => (button.textContent = '复制密钥'), 2000);
                            });
                        });

                        codeBlock.appendChild(codeHeader);
                        codeBlock.appendChild(pre);
                        codeBlock.appendChild(button);
                        codeList.appendChild(codeBlock);
                    }
                });

                if (codeList.innerHTML === '') {
                    codeList.textContent = '未找到有效的密钥。';
                }
            })
            .catch(error => {
                codeList.textContent = '加载失败，请检查 codes.txt 文件是否存在。';
                console.error(error);
            });
    </script>
</body>
</html>